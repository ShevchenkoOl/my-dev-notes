// ============================================================================
// ðŸ“˜ Ð ÐžÐ—Ð”Ð†Ð› 1: Ð¢ÐµÐ¾Ñ€Ñ–Ñ API Ñ‚Ð° Ð²Ð¸Ð´Ð¸ API
// ============================================================================

// API (Application Programming Interface â€” Ñ–Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼ÑƒÐ²Ð°Ð½Ð½Ñ Ð´Ð¾Ð´Ð°Ñ‚ÐºÑ–Ð²) â€”
// Ñ†Ðµ Ð½Ð°Ð±Ñ–Ñ€ Ð¿Ñ€Ð°Ð²Ð¸Ð» Ñ– Ð¼ÐµÑ‚Ð¾Ð´Ñ–Ð², Ð· Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð¾ÑŽ ÑÐºÐ¸Ñ… Ð¾Ð´Ð½Ð° Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð° Ð¼Ð¾Ð¶Ðµ Ð²Ð·Ð°Ñ”Ð¼Ð¾Ð´Ñ–ÑÑ‚Ð¸ Ð· Ñ–Ð½ÑˆÐ¾ÑŽ.

// ðŸ‘‰ ÐŸÑ€Ð¸ÐºÐ»Ð°Ð´:
// Ð£ Ñ‚ÐµÐ±Ðµ Ñ” Ð´Ð¾Ð´Ð°Ñ‚Ð¾Ðº-Ð¿Ð¾Ð³Ð¾Ð´Ð°. Ð’Ñ–Ð½ Ð½Ðµ Ð·Ð±Ð¸Ñ€Ð°Ñ” Ð´Ð°Ð½Ñ– ÑÐ°Ð¼, Ð° Ð·Ð²ÐµÑ€Ñ‚Ð°Ñ”Ñ‚ÑŒÑÑ Ð´Ð¾ API Ð¿Ð¾Ð³Ð¾Ð´Ð½Ð¾Ð³Ð¾ ÑÐµÑ€Ð²Ñ–ÑÑƒ
// Ñ– Ð¾Ñ‚Ñ€Ð¸Ð¼ÑƒÑ” Ð´Ð°Ð½Ñ– (Ñ‚ÐµÐ¼Ð¿ÐµÑ€Ð°Ñ‚ÑƒÑ€Ñƒ, Ð²Ð¾Ð»Ð¾Ð³Ñ–ÑÑ‚ÑŒ Ñ‚Ð¾Ñ‰Ð¾). Ð¢Ð¸, ÑÐº Ñ€Ð¾Ð·Ñ€Ð¾Ð±Ð½Ð¸Ðº, Ð¼Ð¾Ð¶ÐµÑˆ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ñ‚Ð¸ Ñ†ÐµÐ¹ API,
// Ñ‰Ð¾Ð± Ð²Ð±ÑƒÐ´ÑƒÐ²Ð°Ñ‚Ð¸ Ð¿Ð¾Ð³Ð¾Ð´Ñƒ Ñƒ ÑÐ²Ñ–Ð¹ Ð´Ð¾Ð´Ð°Ñ‚Ð¾Ðº.

// REST API â€” Ñ†Ðµ Ð¾Ð´Ð¸Ð½ Ð· Ð²Ð¸Ð´Ñ–Ð² API, Ð¾ÑÐ½Ð¾Ð²Ð°Ð½Ð¸Ð¹ Ð½Ð° Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿Ð°Ñ… REST (Representational State Transfer).
// ÐÐ°Ð¹Ñ‡Ð°ÑÑ‚Ñ–ÑˆÐµ Ð¿Ñ€Ð°Ñ†ÑŽÑ” Ñ‡ÐµÑ€ÐµÐ· HTTP Ñ– Ð´Ð¾Ð·Ð²Ð¾Ð»ÑÑ” ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð°Ð¼ (Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ñƒ, Ð¼Ð¾Ð±Ñ–Ð»ÑŒÐ½Ð¾Ð¼Ñƒ Ð·Ð°ÑÑ‚Ð¾ÑÑƒÐ½ÐºÑƒ)
// Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð»ÑÑ‚Ð¸ HTTP-Ð·Ð°Ð¿Ð¸Ñ‚Ð¸ (GET, POST, PUT, DELETE) Ñ‚Ð° Ð¾Ñ‚Ñ€Ð¸Ð¼ÑƒÐ²Ð°Ñ‚Ð¸ Ð´Ð°Ð½Ñ– Ñƒ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñ– JSON Ð°Ð±Ð¾ XML.

// ðŸ”¹ ÐžÑÐ½Ð¾Ð²Ð½Ñ– Ð²Ð¸Ð´Ð¸ API:
// 1. REST API â€” Ð¿Ñ€Ð¾ÑÑ‚Ð¸Ð¹ Ñ– Ð·Ñ€Ð¾Ð·ÑƒÐ¼Ñ–Ð»Ð¸Ð¹ (GitHub API, Telegram Bot API)
// 2. SOAP API â€” ÑÑ‚Ñ€Ð¾Ð³Ð¸Ð¹ ÑÑ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚, XML, WSDL (ÑÑ‚Ð°Ñ€Ñ– Ð±Ð°Ð½ÐºÑ–Ð²ÑÑŒÐºÑ– ÑÐµÑ€Ð²Ñ–ÑÐ¸)
// 3. GraphQL API â€” Ð¾Ð´Ð¸Ð½ endpoint, ÐºÐ»Ñ–Ñ”Ð½Ñ‚ ÑÐ°Ð¼ Ð²Ð¸Ð±Ð¸Ñ€Ð°Ñ” Ð¿Ð¾Ð»Ñ (Facebook)
// 4. WebSocket API â€” Ð¿Ð¾ÑÑ‚Ñ–Ð¹Ð½Ðµ Ð´Ð²Ð¾ÑÑ‚Ð¾Ñ€Ð¾Ð½Ð½Ñ” Ð·'Ñ”Ð´Ð½Ð°Ð½Ð½Ñ (Ñ‡Ð°Ñ‚Ð¸, Ñ–Ð³Ñ€Ð¸, Ð±Ñ–Ñ€Ð¶Ñ–)
// 5. gRPC â€” ÑˆÐ²Ð¸Ð´ÐºÐ¸Ð¹, protobuf, Ñ‡Ð°ÑÑ‚Ð¾ Ð´Ð»Ñ Ð¼Ñ–ÐºÑ€Ð¾ÑÐµÑ€Ð²Ñ–ÑÑ–Ð²
// 6. SDK/API Ñ‡ÐµÑ€ÐµÐ· Ð±Ñ–Ð±Ð»Ñ–Ð¾Ñ‚ÐµÐºÐ¸ â€” Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´, DOM API, Java API, Python Pandas API
// 7. ÐžÐ¿ÐµÑ€Ð°Ñ†Ñ–Ð¹Ð½Ñ– ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ– API â€” Windows API, POSIX API

// Middleware â€” Ð¿Ñ€Ð¾Ð¼Ñ–Ð¶Ð½Ñ– Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ—, Ñ‰Ð¾ Ð²Ð¸ÐºÐ¾Ð½ÑƒÑŽÑ‚ÑŒÑÑ Ð¼Ñ–Ð¶ Ð·Ð°Ð¿Ð¸Ñ‚Ð¾Ð¼ Ñ‚Ð° Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð´ÑŽ ÑÐµÑ€Ð²ÐµÑ€Ð°.
// ÐŸÑ€Ð¸ÐºÐ»Ð°Ð´Ð¸: Ð»Ð¾Ð³ÑƒÐ²Ð°Ð½Ð½Ñ, Ð¾Ð±Ñ€Ð¾Ð±ÐºÐ° Ð¿Ð¾Ð¼Ð¸Ð»Ð¾Ðº, Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ°Ñ†Ñ–Ñ, CORS.


// ============================================================================
// ðŸ›  Ð ÐžÐ—Ð”Ð†Ð› 2: ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ Express Ñ‚Ð° middleware
// ============================================================================

// ÐŸÑ€Ð¾Ð¼Ñ–Ð¶Ð½Ðµ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð½Ðµ Ð·Ð°Ð±ÐµÐ·Ð¿ÐµÑ‡ÐµÐ½Ð½Ñ (middleware):
// Middleware â€” Ñ†Ðµ Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ—, ÑÐºÑ– Ð²Ð¸ÐºÐ¾Ð½ÑƒÑŽÑ‚ÑŒÑÑ Ð¿Ñ–Ð´ Ñ‡Ð°Ñ Ð¾Ð±Ñ€Ð¾Ð±ÐºÐ¸ Ð·Ð°Ð¿Ð¸Ñ‚Ñƒ Ð´Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð°, Ð°Ð»Ðµ Ð¿ÐµÑ€ÐµÐ´ Ñ‚Ð¸Ð¼, ÑÐº Ð±ÑƒÐ´Ðµ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð° Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ.
import express from "express";
import moment from "moment"; // Ð‘Ñ–Ð±Ð»Ñ–Ð¾Ñ‚ÐµÐºÐ° Moment.js Ð´Ð»Ñ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ Ð· Ð´Ð°Ñ‚Ð°Ð¼Ð¸ Ð°Ð»Ðµ Ð²Ð¾Ð½Ð° Ñ‚Ñ€Ð¾Ð·Ð¸ Ð·Ð°ÑÑ‚Ð°Ñ€Ñ–Ð»Ð° Ñ– ÐºÑ€Ð°Ñ‰Ðµ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ²Ð°Ñ‚Ð¸ date-fns Ð°Ð±Ð¾ luxon
const app = express();
// ÐÐ°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´, Ð¼Ð¸ Ð¼Ð¾Ð¶ÐµÐ¼Ð¾ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ²Ð°Ñ‚Ð¸ middleware Ð´Ð»Ñ Ð»Ð¾Ð³ÑƒÐ²Ð°Ð½Ð½Ñ Ð·Ð°Ð¿Ð¸Ñ‚Ñ–Ð², Ð¾Ð±Ñ€Ð¾Ð±ÐºÐ¸ Ð¿Ð¾Ð¼Ð¸Ð»Ð¾Ðº Ð°Ð±Ð¾ Ð°Ð²Ñ‚ÐµÐ½Ñ‚Ð¸Ñ„Ñ–ÐºÐ°Ñ†Ñ–Ñ— ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ñ–Ð².
app.use(async(req, res, next) => {   // next() â€” Ñ†Ðµ Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ, ÑÐºÐ° Ð¿ÐµÑ€ÐµÐ´Ð°Ñ” ÑƒÐ¿Ñ€Ð°Ð²Ð»Ñ–Ð½Ð½Ñ Ð½Ð°ÑÑ‚ÑƒÐ¿Ð½Ð¾Ð¼Ñƒ middleware Ð°Ð±Ð¾ Ð¾Ð±Ñ€Ð¾Ð±Ð½Ð¸ÐºÑƒ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ñƒ. Ð¯ÐºÑ‰Ð¾ Ð½Ðµ Ð±ÑƒÐ´Ðµ next(), Ð·Ð°Ð¿Ð¸Ñ‚ "Ð·Ð°Ð²Ð¸ÑÐ½Ðµ", Ñ‚Ð¾Ð±Ñ‚Ð¾ ÑÐµÑ€Ð²ÐµÑ€ Ð²Ð¸ÐºÐ¾Ð½Ð°Ñ” Ñ†ÐµÐ¹ Ð·Ð°Ð¿Ð¸Ñ‚ Ñ– Ð·ÑƒÐ¿Ð¸Ð½Ð¸Ð¸ÑŒÑÑ, Ð° Ð´Ð¾ ÑÐ²Ð¾Ð³Ð¾ Ð¼Ð°Ñ€ÑˆÐ¿ÐºÑ‚Ðº ÑÐºÐ¸Ð¹ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ Ð½Ðµ Ð´Ñ–Ð¹Ð´Ðµ.
  
    // Ð¢ÑƒÑ‚ Ð¼Ð¾Ð¶Ð½Ð° Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ð»Ð¾Ð³Ñ–ÐºÑƒ, Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´, Ð»Ð¾Ð³ÑƒÐ²Ð°Ð½Ð½Ñ Ð·Ð°Ð¿Ð¸Ñ‚Ñ–Ð²
    const { method, url } = req;
    console.log(`Ð—Ð°Ð¿Ð¸Ñ‚: ${req.method} ${req.url}`);
    const date = moment().format("YYYY-MM-DD HH:mm:ss"); // moment() Ð¿Ð¾Ñ…Ð¾Ð´Ð¸Ñ‚ÑŒ Ð· Ð±Ñ–Ð±Ð»Ñ–Ð¾Ñ‚ÐµÐºÐ¸ Moment.js â€” Ñ†Ðµ Ð¿Ð¾Ð¿ÑƒÐ»ÑÑ€Ð½Ð° Ð±Ñ–Ð±Ð»Ñ–Ð¾Ñ‚ÐµÐºÐ° JavaScript Ð´Ð»Ñ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ Ð· Ð´Ð°Ñ‚Ð°Ð¼Ð¸ Ñ‚Ð° Ñ‡Ð°ÑÐ¾Ð¼. moment() â€” Ñ†Ðµ Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ, ÑÐºÐ° ÑÑ‚Ð²Ð¾Ñ€ÑŽÑ” Ð¾Ð±'Ñ”ÐºÑ‚ Ð´Ð°Ñ‚Ð¸/Ñ‡Ð°ÑÑƒ. Ð’Ð¾Ð½Ð° Ð´Ð¾Ð·Ð²Ð¾Ð»ÑÑ” Ð»ÐµÐ³ÐºÐ¾: Ð¾Ñ‚Ñ€Ð¸Ð¼ÑƒÐ²Ð°Ñ‚Ð¸ Ð¿Ð¾Ñ‚Ð¾Ñ‡Ð½Ñƒ Ð´Ð°Ñ‚Ñƒ Ð¹ Ñ‡Ð°Ñ; Ð¿Ð°Ñ€ÑÐ¸Ñ‚Ð¸ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ñƒ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñ– Ð´Ð°Ñ‚Ð¸; Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ÑƒÐ²Ð°Ñ‚Ð¸ Ð´Ð°Ñ‚Ñƒ Ð² Ð·Ñ€ÑƒÑ‡Ð½Ð¸Ð¹ Ð²Ð¸Ð³Ð»ÑÐ´; Ð´Ð¾Ð´Ð°Ð²Ð°Ñ‚Ð¸/Ð²Ñ–Ð´Ð½Ñ–Ð¼Ð°Ñ‚Ð¸ Ð´Ð½Ñ–, Ð¼Ñ–ÑÑÑ†Ñ–, Ñ€Ð¾ÐºÐ¸ Ñ‚Ð¾Ñ‰Ð¾.
    try {
        await fs.appendFile("./public/logs.txt", `${date} - ${method} ${url}\n`); // fs.appendFile â€” Ñ†Ðµ Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ Ð· Ð¼Ð¾Ð´ÑƒÐ»Ñ fs (file system), ÑÐºÐ° Ð´Ð¾Ð´Ð°Ñ” Ñ‚ÐµÐºÑÑ‚ Ð´Ð¾ Ñ„Ð°Ð¹Ð»Ñƒ. Ð¯ÐºÑ‰Ð¾ Ñ„Ð°Ð¹Ð» Ð½Ðµ Ñ–ÑÐ½ÑƒÑ”, Ð²Ñ–Ð½ Ð±ÑƒÐ´Ðµ ÑÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð¸Ð¹. Ð£ Ð½Ð°ÑˆÐ¾Ð¼Ñƒ Ð²Ð¸Ð¿Ð°Ð´ÐºÑƒ Ð¼Ð¸ Ð·Ð°Ð¿Ð¸ÑÑƒÑ”Ð¼Ð¾ Ð´Ð°Ñ‚Ñƒ, Ð¼ÐµÑ‚Ð¾Ð´ Ð·Ð°Ð¿Ð¸Ñ‚Ñƒ Ñ‚Ð° URL Ñƒ Ñ„Ð°Ð¹Ð» logs.txt.
    } catch (error) {
        console.error("ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ° Ð·Ð°Ð¿Ð¸ÑÑƒ Ð² Ð»Ð¾Ð³:", error);
    }
    next();
}); // - Ð›Ð¾Ð³ÑƒÐ²Ð°Ð½Ð½Ñ HTTP-Ð·Ð°Ð¿Ð¸Ñ‚Ñ–Ð² â€” Ñ†Ðµ Ð¾Ð´Ð½Ð° Ð· Ð¾ÑÐ½Ð¾Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¼Ð¾Ð½Ñ–Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ñƒ Ñ‚Ð° Ð´Ñ–Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸. ÐžÑÑŒ Ð¾ÑÐ½Ð¾Ð²Ð½Ñ– Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ð¸, Ñ‡Ð¾Ð¼Ñƒ Ñ†Ðµ Ñ€Ð¾Ð±Ð»ÑÑ‚ÑŒ:
// âœ… 1. Ð’Ð¸ÑÐ²Ð»ÐµÐ½Ð½Ñ Ð¿Ð¾Ð¼Ð¸Ð»Ð¾Ðº
//       Ð¯ÐºÑ‰Ð¾ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÑÑ” Ð¿Ñ€Ð¾ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñƒ, Ñ‚Ð¸ Ð¼Ð¾Ð¶ÐµÑˆ: Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ½ÑƒÑ‚Ð¸ Ð»Ð¾Ð³, Ð¿Ð¾Ð±Ð°Ñ‡Ð¸Ñ‚Ð¸, ÑÐºÑ– Ð·Ð°Ð¿Ð¸Ñ‚Ð¸ Ð½Ð°Ð´Ñ…Ð¾Ð´Ð¸Ð»Ð¸,ÑÐºÑ– ÑÐ°Ð¼Ðµ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ– Ð²Ñ–Ð´Ð´Ð°Ð²Ð°Ð² ÑÐµÑ€Ð²ÐµÑ€, Ñ– Ð·Ñ€Ð¾Ð·ÑƒÐ¼Ñ–Ñ‚Ð¸, Ñ‰Ð¾ Ð¿Ñ–ÑˆÐ»Ð¾ Ð½Ðµ Ñ‚Ð°Ðº.
// âœ… 2. ÐÐ½Ð°Ð»Ñ–Ð· Ð±ÐµÐ·Ð¿ÐµÐºÐ¸
//       Ð›Ð¾Ð³Ð¸ Ð¼Ð¾Ð¶ÑƒÑ‚ÑŒ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚Ð¸: Ð¿Ñ–Ð´Ð¾Ð·Ñ€Ñ–Ð»Ñ– ÑÐ¿Ñ€Ð¾Ð±Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ñƒ (Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´, Ð¿Ñ–Ð´Ð±Ñ–Ñ€ Ð¿Ð°Ñ€Ð¾Ð»Ñ), Ð°Ñ‚Ð°ÐºÐ¸ Ñ‚Ð¸Ð¿Ñƒ SQL injection, Ð°Ð±Ð¾ DDOS-Ð¿Ð¾Ð´Ñ–Ð±Ð½Ñƒ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ–ÑÑ‚ÑŒ. Ð¦Ðµ Ð´Ð°Ñ” Ð¼Ð¾Ð¶Ð»Ð¸Ð²Ñ–ÑÑ‚ÑŒ Ð²Ñ‡Ð°ÑÐ½Ð¾ Ð·Ñ€ÐµÐ°Ð³ÑƒÐ²Ð°Ñ‚Ð¸!
// âœ… 3. ÐÐ½Ð°Ð»Ñ–Ñ‚Ð¸ÐºÐ° Ñ‚Ð° ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°
//       ÐœÐ¾Ð¶Ð½Ð° Ð°Ð½Ð°Ð»Ñ–Ð·ÑƒÐ²Ð°Ñ‚Ð¸: ÑÐºÑ– Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð¸ Ð½Ð°Ð¹Ð¿Ð¾Ð¿ÑƒÐ»ÑÑ€Ð½Ñ–ÑˆÑ–, Ð· ÑÐºÐ¸Ñ… IP-Ð°Ð´Ñ€ÐµÑ Ð½Ð°Ð¹Ñ‡Ð°ÑÑ‚Ñ–ÑˆÐµ Ð·Ð²ÐµÑ€Ñ‚Ð°ÑŽÑ‚ÑŒÑÑ, Ð² ÑÐºÑ– Ð³Ð¾Ð´Ð¸Ð½Ð¸ ÑÐµÑ€Ð²ÐµÑ€ Ð½Ð°Ð¹Ð±Ñ–Ð»ÑŒÑˆ Ð½Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶ÐµÐ½Ð¸Ð¹.
// âœ… 4. Ð†ÑÑ‚Ð¾Ñ€Ñ–Ñ Ð´Ñ–Ð¹
//       Ð›Ð¾Ð³ â€” Ñ†Ðµ ÑÐº Ñ‡Ð¾Ñ€Ð½Ð° ÑÐºÑ€Ð¸Ð½ÑŒÐºÐ°. Ð¯ÐºÑ‰Ð¾ Ñ‰Ð¾ÑÑŒ Ð·Ð»Ð°Ð¼Ð°Ð»Ð¾ÑÑŒ Ð°Ð±Ð¾ ÑÐµÑ€Ð²ÐµÑ€ Ð²Ð¿Ð°Ð², Ð¼Ð¾Ð¶Ð½Ð° Ð´Ñ–Ð·Ð½Ð°Ñ‚Ð¸ÑÑŒ, Ñ‰Ð¾ Ð²Ñ–Ð´Ð±ÑƒÐ²Ð°Ð»Ð¾ÑÑŒ Ð´Ð¾ Ñ†ÑŒÐ¾Ð³Ð¾.
// âœ… 5. Ð—Ð°ÐºÐ¾Ð½Ð¾Ð´Ð°Ð²Ñ‡Ñ– Ð²Ð¸Ð¼Ð¾Ð³Ð¸
//       Ð£ Ð´ÐµÑÐºÐ¸Ñ… ÐºÑ€Ð°Ñ—Ð½Ð°Ñ… Ñ‡Ð¸ ÑÑ„ÐµÑ€Ð°Ñ… (Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´, Ð±Ð°Ð½ÐºÑ–Ð½Ð³, Ð¾Ñ…Ð¾Ñ€Ð¾Ð½Ð° Ð·Ð´Ð¾Ñ€Ð¾Ð²â€™Ñ) Ð²Ð¸Ð¼Ð¾Ð³Ð¸ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸ Ð·Ð¾Ð±Ð¾Ð²â€™ÑÐ·ÑƒÑŽÑ‚ÑŒ Ð²ÐµÑÑ‚Ð¸ Ð»Ð¾Ð³Ð¸ Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ²Ñ–Ñ€Ð¾Ðº Ñ‚Ð° Ð°ÑƒÐ´Ð¸Ñ‚Ñ–Ð².
// ðŸ› ï¸ Ð›Ð¾Ð³ÑƒÑŽÑ‚ÑŒ Ñƒ Node.js / Express Ð·Ð°Ð·Ð²Ð¸Ñ‡Ð°Ð¹ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÑŽÑ‚ÑŒ Ð±Ñ–Ð±Ð»Ñ–Ð¾Ñ‚ÐµÐºÐ¸:
// [`morgan`](https://www.npmjs.com/package/morgan) â€” Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð³Ð¾ Ð»Ð¾Ð³ÑƒÐ²Ð°Ð½Ð½Ñ HTTP-Ð·Ð°Ð¿Ð¸Ñ‚Ñ–Ð²,
// [`winston`](https://www.npmjs.com/package/winston) â€” Ð´Ð»Ñ Ð³Ð½ÑƒÑ‡ÐºÐ¾Ð³Ð¾ Ð»Ð¾Ð³ÑƒÐ²Ð°Ð½Ð½Ñ Ñƒ Ñ„Ð°Ð¹Ð» Ð°Ð±Ð¾ Ð±Ð°Ð·Ñƒ. 

// ÐšÑ€Ð°Ñ‰Ðµ Ð·Ð±ÐµÑ€Ñ–Ð³Ð°Ñ‚Ð¸ Ð»Ð¾Ð³Ð¸ Ð² Ð¾ÐºÑ€ÐµÐ¼Ñ–Ð¹ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ñ–Ñ—, Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´:
// /logs/logs.txt Ð† Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ñ†ÑŽ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ñ–ÑŽ Ð² .gitignore.
// Ð›Ð¾Ð³ÑƒÐ²Ð°Ñ‚Ð¸ Ð¼Ð¾Ð¶Ð½Ð° Ñ€Ñ–Ð·Ð½Ñ– Ð´Ð°Ð½Ñ– Ð· Ð·Ð°Ð¿Ð¸Ñ‚Ñƒ Ñ‚Ð° Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ–, Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´:
//   req.ip â€” IP ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð°
//   req.headers['user-agent'] â€” Ñ‚Ð¸Ð¿ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð°
//   ÑÑ‚Ð°Ñ‚ÑƒÑ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ– (res.statusCode) â€” Ð°Ð»Ðµ Ð¹Ð¾Ð³Ð¾ Ñ‚Ñ€ÐµÐ±Ð° Ð»Ð¾Ð²Ð¸Ñ‚Ð¸ Ð¿Ñ–ÑÐ»Ñ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ–, Ð´Ð»Ñ Ñ†ÑŒÐ¾Ð³Ð¾ Ñ‚Ñ€ÐµÐ±Ð° Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ð¾Ð±Ñ€Ð¾Ð±Ð½Ð¸Ðº res.on('finish', ...)


// ÐžÐ±Ñ€Ð¾Ð±Ð¸Ð¼Ð¾ Ð¿Ð¾Ð¼Ð¸Ð»ÐºÑƒ 404, ÑÐºÑ‰Ð¾ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ Ð·Ð²ÐµÑ€Ñ‚Ð°Ñ”Ñ‚ÑŒÑÑ Ð´Ð¾ Ð½ÐµÑ–ÑÐ½ÑƒÑŽÑ‡Ð¾Ð³Ð¾ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ñƒ Ð·Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð¾ÑŽ middleware:
app.use((req, res) => {
    res.status(404).send("<h1>404 - Ð¡Ñ‚Ð¾Ñ€Ñ–Ð½ÐºÑƒ Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾!</h1>");
});
// Ð°Ð±Ð¾ Ð¼Ð¾Ð¶Ð½Ð° Ð·Ñ€Ð¾Ð±Ð¸Ñ‚Ð¸ Ñ‚Ð°Ðº:
app.use((req, res) => {
    res.status(404).json({
        error: "Ð¡Ñ‚Ð¾Ñ€Ñ–Ð½ÐºÑƒ Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾!",
        status: 404,
        message: "Ð¡Ñ‚Ð¾Ñ€Ñ–Ð½ÐºÐ°, ÑÐºÑƒ Ð²Ð¸ ÑˆÑƒÐºÐ°Ñ”Ñ‚Ðµ, Ð½Ðµ Ñ–ÑÐ½ÑƒÑ”."
    });
});

// Ð©Ðµ Ð·Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð¾ÑŽ middleware Ð¼Ð¾Ð¶Ð½Ð° Ð¾Ð±Ñ€Ð¾Ð±Ð»ÑÑ‚Ð¸ Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ¸ CORS (Cross-Origin Resource Sharing), Ñ‚Ð¾Ð±Ñ‚Ð¾ Ð´Ð¾Ð·Ð²Ð¾Ð»ÑÑ‚Ð¸ Ð·Ð°Ð¿Ð¸Ñ‚Ð¸ Ð· Ñ–Ð½ÑˆÐ¸Ñ… Ð´Ð¾Ð¼ÐµÐ½Ñ–Ð². Ð¦Ðµ Ð²Ð°Ð¶Ð»Ð¸Ð²Ð¾, ÑÐºÑ‰Ð¾ Ñ‚Ð²Ñ–Ð¹ Ñ„Ñ€Ð¾Ð½Ñ‚ÐµÐ½Ð´ Ñ– Ð±ÐµÐºÐµÐ½Ð´ Ñ€Ð¾Ð·Ð¼Ñ–Ñ‰ÐµÐ½Ñ– Ð½Ð° Ñ€Ñ–Ð·Ð½Ð¸Ñ… Ð´Ð¾Ð¼ÐµÐ½Ð°Ñ… Ð°Ð±Ð¾ Ð¿Ð¾Ñ€Ñ‚Ð°Ñ…. ÐÐ°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´, ÑÐºÑ‰Ð¾ Ñ„Ñ€Ð¾Ð½Ñ‚ÐµÐ½Ð´ Ð½Ð° localhost:3000, Ð° Ð±ÐµÐºÐµÐ½Ð´ Ð½Ð° localhost:5000, Ñ‚Ð¾ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€ Ð¼Ð¾Ð¶Ðµ Ð±Ð»Ð¾ÐºÑƒÐ²Ð°Ñ‚Ð¸ Ð·Ð°Ð¿Ð¸Ñ‚Ð¸ Ñ‡ÐµÑ€ÐµÐ· Ð¿Ð¾Ð»Ñ–Ñ‚Ð¸ÐºÑƒ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸. Ð©Ð¾Ð± Ñ†ÑŒÐ¾Ð³Ð¾ ÑƒÐ½Ð¸ÐºÐ½ÑƒÑ‚Ð¸, Ð¼Ð¾Ð¶Ð½Ð° Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ²Ð°Ñ‚Ð¸ middleware Ð´Ð»Ñ Ð½Ð°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ CORS:
const cors = require ("cors"); // npm i cors
app.use(cors({
    origin: "http://localhost:3000", // Ð”Ð¾Ð·Ð²Ð¾Ð»ÑÑ”Ð¼Ð¾ Ð·Ð°Ð¿Ð¸Ñ‚Ð¸ Ñ‚Ñ–Ð»ÑŒÐºÐ¸ Ð· Ñ†ÑŒÐ¾Ð³Ð¾ Ð´Ð¾Ð¼ÐµÐ½Ñƒ
    methods: ["GET", "POST", "PUT", "DELETE"], // Ð”Ð¾Ð·Ð²Ð¾Ð»ÑÑ”Ð¼Ð¾ Ñ†Ñ– Ð¼ÐµÑ‚Ð¾Ð´Ð¸
    credentials: true // Ð”Ð¾Ð·Ð²Ð¾Ð»ÑÑ”Ð¼Ð¾ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ñƒ ÐºÑƒÐºÑ–Ð²
})); // Ð¦Ðµ Ð´Ð¾Ð·Ð²Ð¾Ð»Ð¸Ñ‚ÑŒ Ñ‚Ð²Ð¾Ñ”Ð¼Ñƒ Ñ„Ñ€Ð¾Ð½Ñ‚ÐµÐ½Ð´Ñƒ Ð½Ð° localhost:3000 Ñ€Ð¾Ð±Ð¸Ñ‚Ð¸ Ð·Ð°Ð¿Ð¸Ñ‚Ð¸ Ð´Ð¾ Ð±ÐµÐºÐµÐ½Ð´Ñƒ Ð½Ð° localhost:5000 Ð±ÐµÐ· Ð¿Ð¾Ð¼Ð¸Ð»Ð¾Ðº CORS.
// Ð°Ð±Ð¾ ÑÐºÑ‰Ð¾ Ñ Ñ…Ð¾Ñ‡Ñƒ Ð´Ð¾Ð·Ð²Ð¾Ð»Ð¸Ñ‚Ð¸ Ð·Ð°Ð¿Ð¸Ñ‚Ð¸ Ð· ÑƒÑÑ–Ñ… Ð´Ð¾Ð¼ÐµÐ½Ñ–Ð², Ð¼Ð¾Ð¶Ð½Ð° Ð·Ñ€Ð¾Ð±Ð¸Ñ‚Ð¸ Ñ‚Ð°Ðº:
app.use(cors({
    origin: "*", // Ð”Ð¾Ð·Ð²Ð¾Ð»ÑÑ”Ð¼Ð¾ Ð·Ð°Ð¿Ð¸Ñ‚Ð¸ Ð· ÑƒÑÑ–Ñ… Ð´Ð¾Ð¼ÐµÐ½Ñ–Ð²
    methods: ["GET", "POST", "PUT", "DELETE"], // Ð”Ð¾Ð·Ð²Ð¾Ð»ÑÑ”Ð¼Ð¾ Ñ†Ñ– Ð¼ÐµÑ‚Ð¾Ð´Ð¸
    credentials: true // Ð”Ð¾Ð·Ð²Ð¾Ð»ÑÑ”Ð¼Ð¾ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‡Ñƒ ÐºÑƒÐºÑ–Ð²
}));
// Ð°Ð±Ð¾ Ñ‚Ð°Ðº:
app.use(cors()); // Ð¦Ðµ Ð´Ð¾Ð·Ð²Ð¾Ð»Ð¸Ñ‚ÑŒ Ð·Ð°Ð¿Ð¸Ñ‚Ð¸ Ð· ÑƒÑÑ–Ñ… Ð´Ð¾Ð¼ÐµÐ½Ñ–Ð² Ñ– Ð²ÑÑ–Ñ… Ð¼ÐµÑ‚Ð¾Ð´Ñ–Ð². ÐÐ»Ðµ Ñ†Ðµ Ð½Ðµ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÑ”Ñ‚ÑŒÑÑ Ñ€Ð¾Ð±Ð¸Ñ‚Ð¸ Ð² Ð¿Ñ€Ð¾Ð´Ð°ÐºÑˆÐ½, Ð±Ð¾ Ð¼Ð¾Ð¶Ðµ Ð±ÑƒÑ‚Ð¸ Ð½ÐµÐ±ÐµÐ·Ð¿ÐµÑ‡Ð½Ð¾. ÐšÑ€Ð°Ñ‰Ðµ Ð²ÐºÐ°Ð·ÑƒÐ²Ð°Ñ‚Ð¸ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ– Ð´Ð¾Ð¼ÐµÐ½Ð¸, Ð· ÑÐºÐ¸Ñ… Ð´Ð¾Ð·Ð²Ð¾Ð»ÐµÐ½Ñ– Ð·Ð°Ð¿Ð¸Ñ‚Ð¸.



// ÐÐµ Ð·Ñ€ÑƒÑ‡Ð½Ð¾ Ñ€Ð¾Ð±Ð¸Ñ‚Ð¸ Ð²ÑÑ– Ð·Ð°Ð¿Ð¸Ñ‚Ð¸ Ð² app.js, Ñ‚Ð¾Ð¼Ñƒ ÑÑ‚Ð²Ð¾Ñ€ÑŽÑ”Ð¼Ð¾ Ð¾ÐºÑ€ÐµÐ¼Ð¸Ð¹ Ñ„Ð°Ð¹Ð» Ð´Ð»Ñ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ Ð· REST API, Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´, routes/api/books.js (Ð´Ð»Ñ ÐºÐ¾Ð¶Ð½Ð¾Ð³Ð¾ Ñ€ÐµÑÑƒÑ€ÑÑƒ Ð¼Ð¾Ð¶Ð½Ð° ÑÑ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ð¾ÐºÑ€ÐµÐ¼Ð¸Ð¹ Ñ„Ð°Ð¹Ð», Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´, books.js, users.js Ñ– Ñ‚.Ð´.).
// routes/api/books.js
const express = require("express");
const router = express.Router(); // app - Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐµÑ‚ÑŒÑÑ Ñ‚Ñ–Ð»ÑŒÐºÐ¸ Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÑƒ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð³Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ñƒ, Ð° ÑÐºÐ·Ñ‰Ð¾ Ð¼Ð¸ Ñ…Ð¾Ñ‡ÐµÐ¼Ð¾ ÑÑ‚Ð²Ð¾Ñ€Ð¸Ñ‚Ð¸ Ð¾ÐºÑ€ÐµÐ¼Ð¸Ð¹ Ñ€Ð¾ÑƒÑ‚ÐµÑ€ Ð´Ð»Ñ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ Ð· API, Ñ‚Ð¾ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÑ”Ð¼Ð¾ express.Router().
const books = require("../../data/books.json"); // ÐŸÑ€Ð¸Ð¿ÑƒÑÑ‚Ð¸Ð¼Ð¾, Ñ‰Ð¾ Ñƒ Ð½Ð°Ñ Ñ” Ñ„Ð°Ð¹Ð» books.json Ð· Ð´Ð°Ð½Ð¸Ð¼Ð¸ ÐºÐ½Ð¸Ð³.
router.get("/", (req, res) => { // ÐžÑ‚Ñ€Ð¸Ð¼Ð°Ð½Ð½Ñ Ð²ÑÑ–Ñ… ÐºÐ½Ð¸Ð³
    res.json(books); // Ð’Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð»ÑÑ”Ð¼Ð¾ Ð¼Ð°ÑÐ¸Ð² ÐºÐ½Ð¸Ð³ Ñƒ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñ– JSON
});
router.get("/:id", (req, res) => { // ÐžÑ‚Ñ€Ð¸Ð¼Ð°Ð½Ð½Ñ ÐºÐ½Ð¸Ð³Ð¸ Ð·Ð° ID
    req.json(books[0]); // ÐžÑ‚Ñ€Ð¸Ð¼ÑƒÑ”Ð¼Ð¾ ID ÐºÐ½Ð¸Ð³Ð¸ Ð· Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ–Ð² URL
});

module.exports = router; // Ð•ÐºÑÐ¿Ð¾Ñ€Ñ‚ÑƒÑ”Ð¼Ð¾ Ñ€Ð¾ÑƒÑ‚ÐµÑ€, Ñ‰Ð¾Ð± Ð¹Ð¾Ð³Ð¾ Ð¼Ð¾Ð¶Ð½Ð° Ð±ÑƒÐ»Ð¾ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ²Ð°Ñ‚Ð¸ Ð² Ñ–Ð½ÑˆÐ¸Ñ… Ñ„Ð°Ð¹Ð»Ð°Ñ….

// app.js
import express from "express";
const cors = require("cors");
import booksRouter from "./routes/api/books.js"; // Ð†Ð¼Ð¿Ð¾Ñ€Ñ‚ÑƒÑ”Ð¼Ð¾ Ñ€Ð¾ÑƒÑ‚ÐµÑ€ Ð´Ð»Ñ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ Ð· ÐºÐ½Ð¸Ð³Ð°Ð¼Ð¸
// const app = express();
app.use(cors()); // Ð”Ð¾Ð´Ð°Ñ”Ð¼Ð¾ CORS, Ñ‰Ð¾Ð± Ð´Ð¾Ð·Ð²Ð¾Ð»Ð¸Ñ‚Ð¸ Ð·Ð°Ð¿Ð¸Ñ‚Ð¸ Ð· Ñ–Ð½ÑˆÐ¸Ñ… Ð´Ð¾Ð¼ÐµÐ½Ñ–Ð²
app.use(express.json()); // Ð”Ð¾Ð´Ð°Ñ”Ð¼Ð¾ middleware Ð´Ð»Ñ Ð¾Ð±Ñ€Ð¾Ð±ÐºÐ¸ JSON-Ñ‚ bodies Ð·Ð°Ð¿Ð¸Ñ‚
app.use("/api/books", booksRouter); // Ð¯ÐºÑ‰Ð¾ Ð·Ð°Ð¿Ð¸Ñ‚ Ð´Ð¾ API Ð¿Ð¾Ñ‡Ð¸Ð½Ð°Ð»Ð¸ÑÑ Ð· /api/books, Ñ‚Ð¾ Ñ‚Ð¾ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ ÑˆÑƒÐºÐ°Ð¹ Ð² booksRouter, Ñ‚Ð¾Ð±Ñ‚Ð¾ Ð² routes/api/books.js
app.use((req, res) => { // Ð¯ÐºÑ‰Ð¾ Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾ Ð¶Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ñƒ, Ñ‚Ð¾ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð»ÑÑ”Ð¼Ð¾ 404
    res.status(404).json({ message: "Not Found" });
});
// Ð—Ð°Ð¿ÑƒÑÐºÐ°Ñ”Ð¼Ð¾ ÑÐµÑ€Ð²ÐµÑ€ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 3000
app.listen(3000, () => {
    console.log("Server running on http://localhost:3000");
});


// ============================================================================
// ðŸ“‚ Ð ÐžÐ—Ð”Ð†Ð› 3: CRUD Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´Ð¸ Ð· JSON
// ============================================================================

// Ð¼ÐµÑ‚Ð¾Ð´Ð¸ HTTP Ð´Ð»Ñ REST API:

// req.params - Ð¼Ñ–ÑÑ‚Ð¸Ñ‚ÑŒ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¸ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ñƒ, Ð²ÐºÐ°Ð·Ð°Ð½Ñ– Ð² URL. Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÑ”Ñ‚ÑŒÑÑ Ð¿Ñ€Ð¸ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð°Ñ… Ð· Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ð°Ð¼Ð¸, 
// ÐÐ°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´: GET http://localhost:3000/users/123
app.get("/users/:id", (req, res) => {
    console.log(req.params.id); // ÐžÑ‚Ñ€Ð¸Ð¼Ð°Ñ”Ð¼Ð¾ "123" Ð¿Ñ€Ð¸ Ð·Ð°Ð¿Ð¸Ñ‚Ñ– /users/123
});
// Ð°Ð±Ð¾  GET http://localhost:3000/users/123/lovelyType
app.get("/users/:id/:type", (req, res) => {
    console.log(req.params); // ÐžÑ‚Ñ€Ð¸Ð¼Ð°Ñ”Ð¼Ð¾ {id: "123", type: "lovelyType"}
    console.log(req.params.id); // ÐžÑ‚Ñ€Ð¸Ð¼Ð°Ñ”Ð¼Ð¾ "123"
    console.log(req.params.type); // ÐžÑ‚Ñ€Ð¸Ð¼Ð°Ñ”Ð¼Ð¾ "loveluType"
});


// req.query - Ð¼Ñ–ÑÑ‚Ð¸Ñ‚ÑŒ query-Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¸ â€” Ñ‡Ð°ÑÑ‚Ð¸Ð½Ð° URL Ð¿Ñ–ÑÐ»Ñ Ð·Ð½Ð°ÐºÐ° ? ÐŸÑ€Ð°Ñ†ÑŽÑ” Ð½Ð° Ð²ÑÑ–Ñ… Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð°Ñ…, Ð½Ðµ Ð²Ð¸Ð¼Ð°Ð³Ð°Ñ” ÑÐ¿ÐµÑ†Ñ–Ð°Ð»ÑŒÐ½Ð¸Ñ… Ð¿Ð»ÐµÐ¹ÑÑ…Ð¾Ð»Ð´ÐµÑ€Ñ–Ð²
// ÐÐ°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´: GET http://localhost:3000/users?id=123
app.get("/", (req, res) => {
    console.log(req.query.id); // Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ñ”Ð¼Ð¾ "123"
});

//req.body - Ð¼Ñ–ÑÑ‚Ð¸Ñ‚ÑŒ Ñ‚Ñ–Ð»Ð¾ Ð·Ð°Ð¿Ð¸Ñ‚Ñƒ (Ð·Ð°Ð·Ð²Ð¸Ñ‡Ð°Ð¹ Ð´Ð»Ñ POST, PUT, PATCH Ð·Ð°Ð¿Ð¸Ñ‚Ñ–Ð²). ÐŸÐ¾Ñ‚Ñ€ÐµÐ±ÑƒÑ” middleware, Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´ express.json()
// ÐŸÑ€Ð¸ÐºÐ»Ð°Ð´:
app.post("/users", (req, res) => {
    console.log(req.body); // ÐžÑ‚Ñ€Ð¸Ð¼Ð°Ñ”Ð¼Ð¾ Ñ‚Ñ–Ð»Ð¾ Ð·Ð°Ð¿Ð¸Ñ‚Ñƒ, Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´: { name: "Alice" }
});

// req.headers - Ð¼Ñ–ÑÑ‚Ð¸Ñ‚ÑŒ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸ Ð·Ð°Ð¿Ð¸Ñ‚Ñƒ (Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´, Authorization, Content-Type Ñ– Ñ‚.Ð´.)
app.get("/check", (req, res) => {
    console.log(req.headers['authorization']);
});

// req.method - Ð¼Ñ–ÑÑ‚Ð¸Ñ‚ÑŒ HTTP-Ð¼ÐµÑ‚Ð¾Ð´ Ð·Ð°Ð¿Ð¸Ñ‚Ñƒ (GET, POST, PUT, DELETE Ñ– Ñ‚.Ð´.)
app.get("/method", (req, res) => {
    console.log(req.method); // ÐžÑ‚Ñ€Ð¸Ð¼Ð°Ñ”Ð¼Ð¾ "GET" Ð¿Ñ€Ð¸ Ð·Ð°Ð¿Ð¸Ñ‚Ñ– /method
});

// 1. GET â€” Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð½Ð½Ñ Ð´Ð°Ð½Ð¸Ñ… (Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´, ÑÐ¿Ð¸ÑÐ¾Ðº ÐºÐ½Ð¸Ð³ Ð°Ð±Ð¾ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ–Ð²)
const getAllContacts = async () => {
  try {
    const contactsPath = path.resolve("contacts.json");
    const data = await fs.readFile(contactsPath, "utf-8"); // Ñ‡Ð¸Ñ‚Ð°Ñ”Ð¼Ð¾ Ñ„Ð°Ð¹Ð» ÑÐº Ñ‚ÐµÐºÑÑ‚
    return JSON.parse(data); // Ð¿ÐµÑ€ÐµÑ‚Ð²Ð¾Ñ€ÑŽÑ”Ð¼Ð¾ JSON-Ñ‚ÐµÐºÑÑ‚ Ñƒ Ð¼Ð°ÑÐ¸Ð² Ð¾Ð±â€™Ñ”ÐºÑ‚Ñ–Ð²
  } catch (error) {
    console.log("ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð½Ð½Ñ– ÑÐ¿Ð¸ÑÐºÑƒ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ–Ð²:", error.message);
  }
};

// 2. GET - ÐžÑ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚ Ð¿Ð¾ ID
const getContactById = async (contactId) => {
  try {
    const contacts = await getAllContacts();
    return contacts.find((contact) => contact.id === contactId) || null;
  } catch (error) {
    console.log("ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ° Ð¿Ñ€Ð¸ Ð¿Ð¾ÑˆÑƒÐºÑƒ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð°:", error.message);
  }
};

// 3. POST - Ð”Ð¾Ð´Ð°Ñ‚Ð¸ Ð½Ð¾Ð²Ð¸Ð¹ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚
// Joi-ÑÑ…ÐµÐ¼Ð° Ð´Ð»Ñ Ð²Ð°Ð»Ñ–Ð´Ð°Ñ†Ñ–Ñ— Ð²Ð²ÐµÐ´ÐµÐ½Ð¸Ñ… Ð´Ð°Ð½Ð¸Ñ…
const contactAddSchema = Joi.object({
  name: Joi.string().min(3).required(), // Ñ–Ð¼â€™Ñ â€” Ð¼Ñ–Ð½Ñ–Ð¼ÑƒÐ¼ 3 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¸
  email: Joi.string()
    .email({ tlds: { allow: false } }) // Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ email
    .required(),
  phone: Joi.string()
    .pattern(/^\+?[0-9]{7,15}$/) // Ð½Ð¾Ð¼ÐµÑ€ Ð²Ñ–Ð´ 7 Ð´Ð¾ 15 Ñ†Ð¸Ñ„Ñ€, Ð¼Ð¾Ð¶Ðµ Ð¿Ð¾Ñ‡Ð¸Ð½Ð°Ñ‚Ð¸ÑÑ Ð· "+"
    .required(),
});

const addContact = async (body) => {
  try {
    // ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ð´Ð°Ð½Ð¸Ñ…
    const { error } = contactAddSchema.validate(body, { abortEarly: false });
    if (error) {
      throw new Error("ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ° Ð²Ð°Ð»Ñ–Ð´Ð°Ñ†Ñ–Ñ—: " + error.message);
    }

    const contacts = await getAllContacts();
    const newContact = { id: nanoid(), ...body };

    contacts.push(newContact); // Ð´Ð¾Ð´Ð°Ñ”Ð¼Ð¾ Ñƒ Ð¼Ð°ÑÐ¸Ð²
    await fs.writeFile(contactsPath, JSON.stringify(contacts, null, 2));

    return newContact;
  } catch (error) {
    console.log("ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ° Ð¿Ñ€Ð¸ Ð´Ð¾Ð´Ð°Ð²Ð°Ð½Ð½Ñ– ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð°:", error.message);
  }
};

// 4. PUT - ÐžÐ½Ð¾Ð²Ð¸Ñ‚Ð¸ Ñ–ÑÐ½ÑƒÑŽÑ‡Ð¸Ð¹ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚
// =============================
const updateContact = async (id, body) => {
  try {
    // ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ð´Ð°Ð½Ð¸Ñ…
    const { error } = contactAddSchema.validate(body, { abortEarly: false });
    if (error) {
      throw new Error("ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ° Ð²Ð°Ð»Ñ–Ð´Ð°Ñ†Ñ–Ñ—: " + error.message);
    }

    const contacts = await getAllContacts();
    const index = contacts.findIndex((item) => item.id === id);

    if (index === -1) {
      return null; // ÑÐºÑ‰Ð¾ Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾
    }

    contacts[index] = { id, ...body };
    await fs.writeFile(contactsPath, JSON.stringify(contacts, null, 2));

    return contacts[index];
  } catch (error) {
    console.log("ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ– ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð°:", error.message);
  }
};

// 5. DELETE - Ð’Ð¸Ð´Ð°Ð»Ð¸Ñ‚Ð¸ ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚
const removeContact = async (id) => {
  try {
    const contacts = await getAllContacts();
    const index = contacts.findIndex((item) => item.id === id);

    if (index === -1) {
      return null; // ÑÐºÑ‰Ð¾ Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾
    }

    const removedContact = contacts.splice(index, 1)[0];
    await fs.writeFile(contactsPath, JSON.stringify(contacts, null, 2));

    return removedContact;
  } catch (error) {
    console.log("ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ° Ð¿Ñ€Ð¸ Ð²Ð¸Ð´Ð°Ð»ÐµÐ½Ð½Ñ– ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð°:", error.message);
  }
};

// ============================================================================
// ðŸ”¹ HttpError helper
// ============================================================================
const HttpError = (status, message) => {
    const error = new Error(message);
    error.status = status;
    return error;
};

// ============================================================================
// ðŸ”¹ ÐŸÑ€Ð¸ÐºÐ»Ð°Ð´Ð¸ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ (Ð¼Ð¾Ð¶Ð½Ð° Ð·Ð°ÐºÐ¾Ð¼ÐµÐ½Ñ‚ÑƒÐ²Ð°Ñ‚Ð¸ Ð¿Ñ–Ð´ Ñ‡Ð°Ñ Ð·Ð°Ð¿ÑƒÑÐºÑƒ ÑÐµÑ€Ð²ÐµÑ€Ð°)
// ============================================================================
// (async () => {
//   console.log(await getAllContacts());
//   console.log(await getContactById("AeHIrLTr6JkxGE6SN-0Rw"));
//   console.log(await addContact({ name: "Ivan Petrov", email: "ivan@gmail.com", phone: "+380671234567" }));
//   console.log(await updateContact("AeHIrLTr6JkxGE6SN-0Rw", { name: "Updated Name", email: "new@mail.com", phone: "+380671234568" }));
//   console.log(await removeContact("AeHIrLTr6JkxGE6SN-0Rw"));
// })();